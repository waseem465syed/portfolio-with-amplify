"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.Domain = void 0;
const jsiiDeprecationWarnings = require("../.warnings.jsii.js");
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const core_1 = require("aws-cdk-lib/core");
const aws_amplify_1 = require("aws-cdk-lib/aws-amplify");
/**
 * An Amplify Console domain
 */
class Domain extends core_1.Resource {
    constructor(scope, id, props) {
        super(scope, id);
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_amplify_alpha_DomainProps(props);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, Domain);
            }
            throw error;
        }
        this.subDomains = props.subDomains || [];
        const domainName = props.domainName || id;
        if (!core_1.Token.isUnresolved(domainName) && domainName.length > 255) {
            throw new Error(`Domain name must be 255 characters or less, got: ${domainName.length} characters.`);
        }
        if (!core_1.Token.isUnresolved(domainName) && !/^(((?!-)[A-Za-z0-9-]{0,62}[A-Za-z0-9])\.)+((?!-)[A-Za-z0-9-]{1,62}[A-Za-z0-9])(\.)?$/.test(domainName)) {
            throw new Error(`Domain name must be a valid hostname, got: ${domainName}.`);
        }
        const domain = new aws_amplify_1.CfnDomain(this, 'Resource', {
            appId: props.app.appId,
            domainName,
            subDomainSettings: core_1.Lazy.any({ produce: () => this.renderSubDomainSettings() }, { omitEmptyArray: true }),
            enableAutoSubDomain: !!props.enableAutoSubdomain,
            autoSubDomainCreationPatterns: props.autoSubdomainCreationPatterns || ['*', 'pr*'],
            autoSubDomainIamRole: props.autoSubDomainIamRole?.roleArn,
            certificateSettings: props.customCertificate ? {
                certificateType: 'CUSTOM',
                customCertificateArn: props.customCertificate.certificateArn,
            } : undefined,
        });
        this.arn = domain.attrArn;
        this.certificateRecord = domain.attrCertificateRecord;
        this.domainName = domain.attrDomainName;
        this.domainStatus = domain.attrDomainStatus;
        this.statusReason = domain.attrStatusReason;
        this.domainAutoSubDomainCreationPatterns = domain.attrAutoSubDomainCreationPatterns;
        this.domainAutoSubDomainIamRole = domain.attrAutoSubDomainIamRole;
        this.domainEnableAutoSubDomain = domain.attrEnableAutoSubDomain;
        this.node.addValidation({ validate: () => this.validateDomain() });
    }
    /**
     * Maps a branch to a sub domain
     *
     * @param branch The branch
     * @param prefix The prefix. Use '' to map to the root of the domain. Defaults to branch name.
     */
    mapSubDomain(branch, prefix) {
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_amplify_alpha_IBranch(branch);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.mapSubDomain);
            }
            throw error;
        }
        this.subDomains.push({ branch, prefix });
        return this;
    }
    /**
     * Maps a branch to the domain root
     */
    mapRoot(branch) {
        try {
            jsiiDeprecationWarnings._aws_cdk_aws_amplify_alpha_IBranch(branch);
        }
        catch (error) {
            if (process.env.JSII_DEBUG !== "1" && error.name === "DeprecationError") {
                Error.captureStackTrace(error, this.mapRoot);
            }
            throw error;
        }
        return this.mapSubDomain(branch, '');
    }
    validateDomain() {
        if (this.subDomains.length === 0) {
            return ['The domain doesn\'t contain any subdomains'];
        }
        return [];
    }
    renderSubDomainSettings() {
        return this.subDomains.map(s => ({
            branchName: s.branch.branchName,
            prefix: s.prefix ?? s.branch.branchName,
        }));
    }
}
exports.Domain = Domain;
_a = JSII_RTTI_SYMBOL_1;
Domain[_a] = { fqn: "@aws-cdk/aws-amplify-alpha.Domain", version: "2.174.1-alpha.0" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9tYWluLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZG9tYWluLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUVBLDJDQUFzRTtBQUV0RSx5REFBb0Q7QUE0RHBEOztHQUVHO0FBQ0gsTUFBYSxNQUFPLFNBQVEsZUFBUTtJQTREbEMsWUFBWSxLQUFnQixFQUFFLEVBQVUsRUFBRSxLQUFrQjtRQUMxRCxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDOzs7Ozs7K0NBN0RSLE1BQU07Ozs7UUErRGYsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUMsVUFBVSxJQUFJLEVBQUUsQ0FBQztRQUV6QyxNQUFNLFVBQVUsR0FBRyxLQUFLLENBQUMsVUFBVSxJQUFJLEVBQUUsQ0FBQztRQUMxQyxJQUFJLENBQUMsWUFBSyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsSUFBSSxVQUFVLENBQUMsTUFBTSxHQUFHLEdBQUcsRUFBRSxDQUFDO1lBQy9ELE1BQU0sSUFBSSxLQUFLLENBQUMsb0RBQW9ELFVBQVUsQ0FBQyxNQUFNLGNBQWMsQ0FBQyxDQUFDO1FBQ3ZHLENBQUM7UUFDRCxJQUFJLENBQUMsWUFBSyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLHNGQUFzRixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDO1lBQ2hKLE1BQU0sSUFBSSxLQUFLLENBQUMsOENBQThDLFVBQVUsR0FBRyxDQUFDLENBQUM7UUFDL0UsQ0FBQztRQUVELE1BQU0sTUFBTSxHQUFHLElBQUksdUJBQVMsQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFO1lBQzdDLEtBQUssRUFBRSxLQUFLLENBQUMsR0FBRyxDQUFDLEtBQUs7WUFDdEIsVUFBVTtZQUNWLGlCQUFpQixFQUFFLFdBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLEVBQUUsRUFBRSxFQUFFLGNBQWMsRUFBRSxJQUFJLEVBQUUsQ0FBQztZQUN4RyxtQkFBbUIsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLG1CQUFtQjtZQUNoRCw2QkFBNkIsRUFBRSxLQUFLLENBQUMsNkJBQTZCLElBQUksQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDO1lBQ2xGLG9CQUFvQixFQUFFLEtBQUssQ0FBQyxvQkFBb0IsRUFBRSxPQUFPO1lBQ3pELG1CQUFtQixFQUFFLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUM7Z0JBQzdDLGVBQWUsRUFBRSxRQUFRO2dCQUN6QixvQkFBb0IsRUFBRSxLQUFLLENBQUMsaUJBQWlCLENBQUMsY0FBYzthQUM3RCxDQUFDLENBQUMsQ0FBQyxTQUFTO1NBQ2QsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLEdBQUcsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDO1FBQzFCLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxNQUFNLENBQUMscUJBQXFCLENBQUM7UUFDdEQsSUFBSSxDQUFDLFVBQVUsR0FBRyxNQUFNLENBQUMsY0FBYyxDQUFDO1FBQ3hDLElBQUksQ0FBQyxZQUFZLEdBQUcsTUFBTSxDQUFDLGdCQUFnQixDQUFDO1FBQzVDLElBQUksQ0FBQyxZQUFZLEdBQUcsTUFBTSxDQUFDLGdCQUFnQixDQUFDO1FBQzVDLElBQUksQ0FBQyxtQ0FBbUMsR0FBRyxNQUFNLENBQUMsaUNBQWlDLENBQUM7UUFDcEYsSUFBSSxDQUFDLDBCQUEwQixHQUFHLE1BQU0sQ0FBQyx3QkFBd0IsQ0FBQztRQUNsRSxJQUFJLENBQUMseUJBQXlCLEdBQUcsTUFBTSxDQUFDLHVCQUF1QixDQUFDO1FBRWhFLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLEVBQUUsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsRUFBRSxDQUFDLENBQUM7S0FDcEU7SUFFRDs7Ozs7T0FLRztJQUNJLFlBQVksQ0FBQyxNQUFlLEVBQUUsTUFBZTs7Ozs7Ozs7OztRQUNsRCxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQ3pDLE9BQU8sSUFBSSxDQUFDO0tBQ2I7SUFFRDs7T0FFRztJQUNJLE9BQU8sQ0FBQyxNQUFlOzs7Ozs7Ozs7O1FBQzVCLE9BQU8sSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUM7S0FDdEM7SUFFTyxjQUFjO1FBQ3BCLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDakMsT0FBTyxDQUFDLDRDQUE0QyxDQUFDLENBQUM7UUFDeEQsQ0FBQztRQUVELE9BQU8sRUFBRSxDQUFDO0tBQ1g7SUFFTyx1QkFBdUI7UUFDN0IsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDL0IsVUFBVSxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBVTtZQUMvQixNQUFNLEVBQUUsQ0FBQyxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVU7U0FDeEMsQ0FBQyxDQUFDLENBQUM7S0FDTDs7QUFqSUgsd0JBa0lDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgYWNtIGZyb20gJ2F3cy1jZGstbGliL2F3cy1jZXJ0aWZpY2F0ZW1hbmFnZXInO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJ2F3cy1jZGstbGliL2F3cy1pYW0nO1xuaW1wb3J0IHsgTGF6eSwgUmVzb3VyY2UsIElSZXNvbHZhYmxlLCBUb2tlbiB9IGZyb20gJ2F3cy1jZGstbGliL2NvcmUnO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG5pbXBvcnQgeyBDZm5Eb21haW4gfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtYW1wbGlmeSc7XG5pbXBvcnQgeyBJQXBwIH0gZnJvbSAnLi9hcHAnO1xuaW1wb3J0IHsgSUJyYW5jaCB9IGZyb20gJy4vYnJhbmNoJztcblxuLyoqXG4gKiBPcHRpb25zIHRvIGFkZCBhIGRvbWFpbiB0byBhbiBhcHBsaWNhdGlvblxuICovXG5leHBvcnQgaW50ZXJmYWNlIERvbWFpbk9wdGlvbnMge1xuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGRvbWFpblxuICAgKlxuICAgKiBAZGVmYXVsdCAtIHRoZSBjb25zdHJ1Y3QncyBpZFxuICAgKi9cbiAgcmVhZG9ubHkgZG9tYWluTmFtZT86IHN0cmluZztcblxuICAvKipcbiAgICogU3ViZG9tYWluc1xuICAgKlxuICAgKiBAZGVmYXVsdCAtIHVzZSBgYWRkU3ViRG9tYWluKClgIHRvIGFkZCBzdWJkb21haW5zXG4gICAqL1xuICByZWFkb25seSBzdWJEb21haW5zPzogU3ViRG9tYWluW107XG5cbiAgLyoqXG4gICAqIEF1dG9tYXRpY2FsbHkgY3JlYXRlIHN1YmRvbWFpbnMgZm9yIGNvbm5lY3RlZCBicmFuY2hlc1xuICAgKlxuICAgKiBAZGVmYXVsdCBmYWxzZVxuICAgKi9cbiAgcmVhZG9ubHkgZW5hYmxlQXV0b1N1YmRvbWFpbj86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIEJyYW5jaGVzIHdoaWNoIHNob3VsZCBhdXRvbWF0aWNhbGx5IGNyZWF0ZSBzdWJkb21haW5zXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gYWxsIHJlcG9zaXRvcnkgYnJhbmNoZXMgWycqJywgJ3ByKiddXG4gICAqL1xuICByZWFkb25seSBhdXRvU3ViZG9tYWluQ3JlYXRpb25QYXR0ZXJucz86IHN0cmluZ1tdO1xuXG4gIC8qKlxuICAgKiBUaGUgdHlwZSBvZiBTU0wvVExTIGNlcnRpZmljYXRlIHRvIHVzZSBmb3IgeW91ciBjdXN0b20gZG9tYWluXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gQW1wbGlmeSB1c2VzIHRoZSBkZWZhdWx0IGNlcnRpZmljYXRlIHRoYXQgaXQgcHJvdmlzaW9ucyBhbmQgbWFuYWdlcyBmb3IgeW91XG4gICAqL1xuICByZWFkb25seSBjdXN0b21DZXJ0aWZpY2F0ZT86IGFjbS5JQ2VydGlmaWNhdGU7XG59XG5cbi8qKlxuICogUHJvcGVydGllcyBmb3IgYSBEb21haW5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBEb21haW5Qcm9wcyBleHRlbmRzIERvbWFpbk9wdGlvbnMge1xuICAvKipcbiAgICogVGhlIGFwcGxpY2F0aW9uIHRvIHdoaWNoIHRoZSBkb21haW4gbXVzdCBiZSBjb25uZWN0ZWRcbiAgICovXG4gIHJlYWRvbmx5IGFwcDogSUFwcDtcblxuICAvKipcbiAgICogVGhlIElBTSByb2xlIHdpdGggYWNjZXNzIHRvIFJvdXRlNTMgd2hlbiB1c2luZyBlbmFibGVBdXRvU3ViZG9tYWluXG4gICAqIEBkZWZhdWx0IHRoZSBJQU0gcm9sZSBmcm9tIEFwcC5ncmFudFByaW5jaXBhbFxuICAgKi9cbiAgcmVhZG9ubHkgYXV0b1N1YkRvbWFpbklhbVJvbGU/OiBpYW0uSVJvbGU7XG59XG5cbi8qKlxuICogQW4gQW1wbGlmeSBDb25zb2xlIGRvbWFpblxuICovXG5leHBvcnQgY2xhc3MgRG9tYWluIGV4dGVuZHMgUmVzb3VyY2Uge1xuXG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBkb21haW5cbiAgICpcbiAgICogQGF0dHJpYnV0ZVxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGFybjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgRE5TIFJlY29yZCBmb3IgY2VydGlmaWNhdGUgdmVyaWZpY2F0aW9uXG4gICAqXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBjZXJ0aWZpY2F0ZVJlY29yZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgZG9tYWluXG4gICAqXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBkb21haW5OYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBzdGF0dXMgb2YgdGhlIGRvbWFpbiBhc3NvY2lhdGlvblxuICAgKlxuICAgKiBAYXR0cmlidXRlXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgZG9tYWluU3RhdHVzOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSByZWFzb24gZm9yIHRoZSBjdXJyZW50IHN0YXR1cyBvZiB0aGUgZG9tYWluXG4gICAqXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBzdGF0dXNSZWFzb246IHN0cmluZztcblxuICAvKipcbiAgICogQnJhbmNoIHBhdHRlcm5zIGZvciB0aGUgYXV0b21hdGljYWxseSBjcmVhdGVkIHN1YmRvbWFpbi5cbiAgICpcbiAgICogQGF0dHJpYnV0ZVxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGRvbWFpbkF1dG9TdWJEb21haW5DcmVhdGlvblBhdHRlcm5zOiBzdHJpbmdbXTtcblxuICAvKipcbiAgICogVGhlIElBTSBzZXJ2aWNlIHJvbGUgZm9yIHRoZSBzdWJkb21haW4uXG4gICAqXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBkb21haW5BdXRvU3ViRG9tYWluSWFtUm9sZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBTcGVjaWZpZXMgd2hldGhlciB0aGUgYXV0b21hdGVkIGNyZWF0aW9uIG9mIHN1YmRvbWFpbnMgZm9yIGJyYW5jaGVzIGlzIGVuYWJsZWQuXG4gICAqXG4gICAqIEBhdHRyaWJ1dGVcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBkb21haW5FbmFibGVBdXRvU3ViRG9tYWluOiBJUmVzb2x2YWJsZTtcblxuICBwcml2YXRlIHJlYWRvbmx5IHN1YkRvbWFpbnM6IFN1YkRvbWFpbltdO1xuXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBEb21haW5Qcm9wcykge1xuICAgIHN1cGVyKHNjb3BlLCBpZCk7XG5cbiAgICB0aGlzLnN1YkRvbWFpbnMgPSBwcm9wcy5zdWJEb21haW5zIHx8IFtdO1xuXG4gICAgY29uc3QgZG9tYWluTmFtZSA9IHByb3BzLmRvbWFpbk5hbWUgfHwgaWQ7XG4gICAgaWYgKCFUb2tlbi5pc1VucmVzb2x2ZWQoZG9tYWluTmFtZSkgJiYgZG9tYWluTmFtZS5sZW5ndGggPiAyNTUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRG9tYWluIG5hbWUgbXVzdCBiZSAyNTUgY2hhcmFjdGVycyBvciBsZXNzLCBnb3Q6ICR7ZG9tYWluTmFtZS5sZW5ndGh9IGNoYXJhY3RlcnMuYCk7XG4gICAgfVxuICAgIGlmICghVG9rZW4uaXNVbnJlc29sdmVkKGRvbWFpbk5hbWUpICYmICEvXigoKD8hLSlbQS1aYS16MC05LV17MCw2Mn1bQS1aYS16MC05XSlcXC4pKygoPyEtKVtBLVphLXowLTktXXsxLDYyfVtBLVphLXowLTldKShcXC4pPyQvLnRlc3QoZG9tYWluTmFtZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRG9tYWluIG5hbWUgbXVzdCBiZSBhIHZhbGlkIGhvc3RuYW1lLCBnb3Q6ICR7ZG9tYWluTmFtZX0uYCk7XG4gICAgfVxuXG4gICAgY29uc3QgZG9tYWluID0gbmV3IENmbkRvbWFpbih0aGlzLCAnUmVzb3VyY2UnLCB7XG4gICAgICBhcHBJZDogcHJvcHMuYXBwLmFwcElkLFxuICAgICAgZG9tYWluTmFtZSxcbiAgICAgIHN1YkRvbWFpblNldHRpbmdzOiBMYXp5LmFueSh7IHByb2R1Y2U6ICgpID0+IHRoaXMucmVuZGVyU3ViRG9tYWluU2V0dGluZ3MoKSB9LCB7IG9taXRFbXB0eUFycmF5OiB0cnVlIH0pLFxuICAgICAgZW5hYmxlQXV0b1N1YkRvbWFpbjogISFwcm9wcy5lbmFibGVBdXRvU3ViZG9tYWluLFxuICAgICAgYXV0b1N1YkRvbWFpbkNyZWF0aW9uUGF0dGVybnM6IHByb3BzLmF1dG9TdWJkb21haW5DcmVhdGlvblBhdHRlcm5zIHx8IFsnKicsICdwcionXSxcbiAgICAgIGF1dG9TdWJEb21haW5JYW1Sb2xlOiBwcm9wcy5hdXRvU3ViRG9tYWluSWFtUm9sZT8ucm9sZUFybixcbiAgICAgIGNlcnRpZmljYXRlU2V0dGluZ3M6IHByb3BzLmN1c3RvbUNlcnRpZmljYXRlID8ge1xuICAgICAgICBjZXJ0aWZpY2F0ZVR5cGU6ICdDVVNUT00nLFxuICAgICAgICBjdXN0b21DZXJ0aWZpY2F0ZUFybjogcHJvcHMuY3VzdG9tQ2VydGlmaWNhdGUuY2VydGlmaWNhdGVBcm4sXG4gICAgICB9IDogdW5kZWZpbmVkLFxuICAgIH0pO1xuXG4gICAgdGhpcy5hcm4gPSBkb21haW4uYXR0ckFybjtcbiAgICB0aGlzLmNlcnRpZmljYXRlUmVjb3JkID0gZG9tYWluLmF0dHJDZXJ0aWZpY2F0ZVJlY29yZDtcbiAgICB0aGlzLmRvbWFpbk5hbWUgPSBkb21haW4uYXR0ckRvbWFpbk5hbWU7XG4gICAgdGhpcy5kb21haW5TdGF0dXMgPSBkb21haW4uYXR0ckRvbWFpblN0YXR1cztcbiAgICB0aGlzLnN0YXR1c1JlYXNvbiA9IGRvbWFpbi5hdHRyU3RhdHVzUmVhc29uO1xuICAgIHRoaXMuZG9tYWluQXV0b1N1YkRvbWFpbkNyZWF0aW9uUGF0dGVybnMgPSBkb21haW4uYXR0ckF1dG9TdWJEb21haW5DcmVhdGlvblBhdHRlcm5zO1xuICAgIHRoaXMuZG9tYWluQXV0b1N1YkRvbWFpbklhbVJvbGUgPSBkb21haW4uYXR0ckF1dG9TdWJEb21haW5JYW1Sb2xlO1xuICAgIHRoaXMuZG9tYWluRW5hYmxlQXV0b1N1YkRvbWFpbiA9IGRvbWFpbi5hdHRyRW5hYmxlQXV0b1N1YkRvbWFpbjtcblxuICAgIHRoaXMubm9kZS5hZGRWYWxpZGF0aW9uKHsgdmFsaWRhdGU6ICgpID0+IHRoaXMudmFsaWRhdGVEb21haW4oKSB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNYXBzIGEgYnJhbmNoIHRvIGEgc3ViIGRvbWFpblxuICAgKlxuICAgKiBAcGFyYW0gYnJhbmNoIFRoZSBicmFuY2hcbiAgICogQHBhcmFtIHByZWZpeCBUaGUgcHJlZml4LiBVc2UgJycgdG8gbWFwIHRvIHRoZSByb290IG9mIHRoZSBkb21haW4uIERlZmF1bHRzIHRvIGJyYW5jaCBuYW1lLlxuICAgKi9cbiAgcHVibGljIG1hcFN1YkRvbWFpbihicmFuY2g6IElCcmFuY2gsIHByZWZpeD86IHN0cmluZykge1xuICAgIHRoaXMuc3ViRG9tYWlucy5wdXNoKHsgYnJhbmNoLCBwcmVmaXggfSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICAvKipcbiAgICogTWFwcyBhIGJyYW5jaCB0byB0aGUgZG9tYWluIHJvb3RcbiAgICovXG4gIHB1YmxpYyBtYXBSb290KGJyYW5jaDogSUJyYW5jaCkge1xuICAgIHJldHVybiB0aGlzLm1hcFN1YkRvbWFpbihicmFuY2gsICcnKTtcbiAgfVxuXG4gIHByaXZhdGUgdmFsaWRhdGVEb21haW4oKSB7XG4gICAgaWYgKHRoaXMuc3ViRG9tYWlucy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBbJ1RoZSBkb21haW4gZG9lc25cXCd0IGNvbnRhaW4gYW55IHN1YmRvbWFpbnMnXTtcbiAgICB9XG5cbiAgICByZXR1cm4gW107XG4gIH1cblxuICBwcml2YXRlIHJlbmRlclN1YkRvbWFpblNldHRpbmdzKCkge1xuICAgIHJldHVybiB0aGlzLnN1YkRvbWFpbnMubWFwKHMgPT4gKHtcbiAgICAgIGJyYW5jaE5hbWU6IHMuYnJhbmNoLmJyYW5jaE5hbWUsXG4gICAgICBwcmVmaXg6IHMucHJlZml4ID8/IHMuYnJhbmNoLmJyYW5jaE5hbWUsXG4gICAgfSkpO1xuICB9XG59XG5cbi8qKlxuICogU3ViIGRvbWFpbiBzZXR0aW5nc1xuICovXG5leHBvcnQgaW50ZXJmYWNlIFN1YkRvbWFpbiB7XG4gIC8qKlxuICAgKiBUaGUgYnJhbmNoXG4gICAqL1xuICByZWFkb25seSBicmFuY2g6IElCcmFuY2g7XG5cbiAgLyoqXG4gICAqIFRoZSBwcmVmaXguIFVzZSAnJyB0byBtYXAgdG8gdGhlIHJvb3Qgb2YgdGhlIGRvbWFpblxuICAgKlxuICAgKiBAZGVmYXVsdCAtIHRoZSBicmFuY2ggbmFtZVxuICAgKi9cbiAgcmVhZG9ubHkgcHJlZml4Pzogc3RyaW5nO1xufVxuIl19